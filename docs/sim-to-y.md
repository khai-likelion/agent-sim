# 비교 분석 보고서 지표 설계 가이드

> `sim_to_y.py` — `ComparisonReportGenerator` 클래스
> 전략 적용 전(Sim 1) vs 후(Sim 2) ABM 시뮬레이션 비교 보고서

---

## 데이터 흐름 개요

```
visit_log.csv (Sim1 / Sim2)
    │
    ├─ _load_sim_data()
    │     ├─ generation 정규화  ("혼합(Z2+Y)" 등 → "혼합" 단일 버킷)
    │     ├─ persona_type 파생  (segment 컬럼 파싱 → 4대 방문목적)
    │     ├─ agent_type 파생    (segment.split("_")[0] → 유동/상주)
    │     ├─ 평점 컬럼 숫자 변환
    │     └─ timestamp → hour 파싱
    │
    ├─ analysis 1~7, 9~11 실행
    │     └─ 결과를 metrics_summary dict에 캐시
    │
    ├─ analysis_safety_diagnosis()   ← 11개 지표 역효과 자동 탐지
    │     └─ metrics_summary["safety"] 에 결과 저장
    │
    ├─ analysis_tradeoff()           ← 얻은 것 vs 잃은 것
    │     └─ metrics_summary["tradeoff"] 에 결과 저장
    │
    ├─ analysis_8 (LLM 요약)
    │     ├─ GPT-5.2 우선 (SUMMARY_OPENAI_API_KEY + SUMMARY_OPENAI_MODEL=gpt-5.2)
    │     ├─ Gemini fallback (LLM_API_KEY)
    │     └─ metrics_summary + 안전성 진단 → 구조화 프롬프트 → 5섹션 출력
    │
    └─ _write_markdown_report()
          └─ Comparison_Report.md + reports/figures/*.svg (워드클라우드만 .png)

※ `generate_all()` 내 각 분석은 `_safe()` 래퍼로 보호됨 — 개별 분석 실패 시 `{}` 반환 후 계속 진행 (전체 보고서 생성 중단 없음)
```

**시뮬레이션 데이터 → visit_log.csv 컬럼 매핑**

| 단계 | LLM 출력 | CSV 컬럼 |
|------|---------|---------|
| Step 2 (업종 선택) | `{"category": ..., "reason": ...}` | `reason` (일부) |
| Step 3 (매장 선택) | `{"store_name": ..., "reason": ...}` | `reason` (주요) |
| Step 4 (방문 후 리뷰) | `{"rating": ..., "comment": ...}` | `comment` ← 실제 리뷰 |

**visit_log.csv 주요 컬럼**

| 컬럼 | 설명 | 관련 지표 |
|------|------|----------|
| `agent_id` | 에이전트 식별자 | 지표 6 (재방문율) |
| `generation` | Z1/Z2/Y/X/S/혼합 | 지표 4, 11 |
| `gender_composition` | 남성만/여성만/혼성 | 지표 10 |
| `segment` | `유동_사적모임형_2인` | agent_type·persona_type 파싱 |
| `time_slot` | 아침/점심/저녁/야식 | 지표 3 |
| `taste/value/atmosphere_rating` | 1~5점 | 지표 2, 5 |
| `reason` | Step2+3 방문 결정 이유 | 지표 1 (fallback) |
| `comment` | Step4 방문 후 실제 리뷰 | 지표 1 (우선) |

**데이터 소스**

| 파일 | 설명 |
|------|------|
| `{dir}/visit_log.csv` | 방문 기록 메인 데이터 |
| `{dir}/simulation_result.csv` | visit_log 없을 때 fallback (decision=visit 필터) |
| `{dir}/store_ratings.json` | 매장 메타 정보 (평균 가격 등) |
| `{dir}/agents_final.json` | 에이전트 최종 상태 |

---

## 지표 1 — 기본 방문 지표 (Overview) + 해시태그 키워드 클라우드

### 설계 의도

> "전략 후 손님이 실제로 늘었는가? 방문자들의 리뷰 키워드가 달라졌는가?"

- **방문 수**는 절대값이라 단독으로 보면 오해가 생길 수 있음
- **시장 점유율**(`타겟 방문 / 전체 방문 × 100`)로 보완 → 경쟁 매장도 함께 성장했다면 점유율은 그대로
- **해시태그 키워드 클라우드** (기존 WordCloud → LLM 기반으로 변경):
  - `comment` + `reason` 텍스트(최대 3000자)를 LLM(Gemini)에 전달
  - 핵심 해시태그 10~15개 추출 (`#분위기맛집`, `#가성비좋음` 형식)
  - Sim 1: 파란 계열 팔레트 / Sim 2: 주황 계열 팔레트로 시각화

### 출력 예시

```
방문 키워드 워드클라우드 비교

[Sim 1 — 전략 전]               [Sim 2 — 전략 후]
   가격대비          맛            분위기      맛
      혼밥     직장인             모임    가성비
  점심특선   메뉴         이벤트    직장인
     편의성               특선메뉴      혼밥
```

**보고서 테이블:**

| 지표 | Sim 1 (전략 전) | Sim 2 (전략 후) | 변화 |
|------|:--------------:|:--------------:|:----:|
| 총 방문 수 | 142건 | 189건 | **+33.1%** |
| 시장 점유율 | 8.20% | 10.45% | +2.25%p |

---

## 지표 2 — 평점 분포 분석 (Rating Spread)

### 설계 의도

> "평균이 오른 게 아니라 분포 자체가 바뀌었는가?"

- **KDE(커널 밀도 추정)** 선택 이유: 에이전트 수가 적을 때 히스토그램은 불연속적으로 튐 → KDE로 연속 분포 형태(단봉/쌍봉, 꼬리 두께)를 관찰
  - 데이터 수 ≥ 2이더라도 **값이 전부 동일하면 분산=0** → `gaussian_kde` 오류 방지를 위해 `s.std() > 0` 조건 추가. 해당 경우 수직선(`axvline`)으로 대체 표시
- **맛/가성비/분위기 3개 분리**: 전략 유형에 따라 오르는 항목이 다름 (예: 가격 할인 전략은 가성비만 오름)
- **만족도 막대**(`≥ 4점 비율`): 평균이 같아도 4점 이상 비율이 다르면 의미가 다름

### 출력 예시

```
[맛 평점 KDE]        [가성비 평점 KDE]     [분위기 평점 KDE]
밀도                 밀도                  밀도
│  ╭─╮ Sim1         │    ╭──╮ Sim1        │  ╭──╮ Sim1
│ ╭╯  ╰╮ Sim2       │  ╭─╯  ╰─╮ Sim2     │  │   │ Sim2
│╭╯    ╰╮           │ ╭╯      ╰╮          │╭─╯   ╰─╮
└───────────점수    └────────────점수     └──────────점수
  1  2  3  4  5       1  2  3  4  5        1  2  3  4  5
```

**보고서 테이블:**

| 지표 | Sim 1 (전략 전) | Sim 2 (전략 후) | 변화 |
|------|:--------------:|:--------------:|:----:|
| 평균 종합 평점 | 3.42점 | 3.81점 | **+0.39** |
| 만족도 (4점 이상) | 31.0% | 54.5% | +23.5%p |

---

## 지표 3 — 시간대별 손님 변화 (Hourly Traffic)

### 설계 의도

> "전략이 특정 시간대에만 효과가 있는가? 피크타임이 바뀌었는가?"

- 4개 타임슬롯(아침 07 / 점심 12 / 저녁 18 / 야식 22)을 **꺾은선 그래프**로 시계열처럼 표현
- 두 선 사이 면적을 보라색으로 채워 **격차**를 직관적으로 강조
- 피크 슬롯 변화는 `metrics_summary`에 저장 → LLM 요약에 자동 전달

### 출력 예시

```
[시간대별 방문 트래픽 변화]

방문횟수
45 │          ●── Sim2 (전략 후)
40 │         ╱  \
35 │        ○    \── Sim1 (전략 전)
30 │       ╱      \  ●
25 │      ╱        ○╱  \
20 │  ○──○                \
15 │                       ○──●
   └──────────────────────────────
     아침(07) 점심(12) 저녁(18) 야식(22)
```

**보고서 테이블:**

| 지표 | Sim 1 | Sim 2 |
|------|:-----:|:-----:|
| 피크 타임슬롯 | 점심(12) | 저녁(18) |

---

## 지표 4 — 세대별 증감 분석 (Generation Impact)

### 설계 의도

> "어떤 세대가 새로 들어오고, 어떤 세대가 빠졌는가?"

- **9개 세대 버킷**으로 비교 (방문 비율 기준, 절대값 아님 — 시뮬레이션 규모 차이 보정)
- 각 막대 위에 **±%p 변화량**을 초록(증가)/빨강(감소)으로 표시
- 혼합 세대는 `special_condition`의 **S/Z1 포함 유무**로 4가지 레이블로 세분화

### 세대 정의

| 코드 | 세대 | 대략적 특성 |
|:----:|------|------------|
| Z1 | Z세대 전기 (10대) | SNS 영향 강함, 트렌드 민감 |
| Z2 | Z세대 후기 (20대 초반) | 가성비·경험 중시 |
| Y | 밀레니얼 (20대 후반~30대) | 직장인 점심 수요 높음 |
| X | X세대 (40대) | 가족 모임, 안정 선호 |
| S | 시니어 (50대+) | 분위기·서비스 중시 |
| 혼합(S, Z1) | S+Z1 포함 | 세대 격차 가장 큰 그룹 (조부모+손자녀) |
| 혼합(S, Z1미포함) | S 포함, Z1 없음 | 중장년 중심 (X+S) |
| 혼합(S미포함, Z1) | Z1 포함, S 없음 | 젊은 가족 (Y+Z1) |
| 혼합(S미포함, Z1미포함) | 중간 세대만 | Y+X, Z2+Y 등 |

**레이블 해소 로직:**
```python
@staticmethod
def _resolve_generation_label(generation: str, special_condition: str) -> str:
    if not isinstance(generation, str) or not generation.startswith("혼합"):
        return generation  # Z1/Z2/Y/X/S 그대로
    sc = special_condition or ""
    s_label  = "S"  if "S포함"  in sc else "S미포함"
    z1_label = "Z1" if "Z1포함" in sc else "Z1미포함"
    return f"혼합({s_label}, {z1_label})"
```

### 출력 예시

```
[세대별 방문 비율 변화]

비율(%)
35 │  +8.2%p
30 │  ■ ■
25 │  ■ ■       -3.1%p
20 │  ■ ■  □□   □■   ■□   □□   □■   □■   ■□   □□
15 │  ...
   └────────────────────────────────────────────────────
     Z1   Z2   Y    X    S  혼합  혼합  혼합   혼합
                             (S,  (S,  (S미   (S미
                             Z1) Z1미) 포함,  포함,
                                      Z1)   Z1미)
   □ Sim1(전략전)  ■ Sim2(전략후)
```

**보고서 테이블:**

| 세대 | Sim 1 (전략 전) | Sim 2 (전략 후) | 변화 |
|:----:|:--------------:|:--------------:|:----:|
| Z1 | 12.0% | 20.2% | **+8.2%p** |
| Z2 | 18.5% | 22.1% | +3.6%p |
| Y | 31.2% | 28.1% | -3.1%p |
| X | 25.0% | 20.8% | -4.2%p |
| S | 13.3% | 8.8% | -4.5%p |
| 혼합(S, Z1) | 2.1% | 3.5% | +1.4%p |
| 혼합(S, Z1미포함) | 1.5% | 1.2% | -0.3%p |
| 혼합(S미포함, Z1) | 1.2% | 1.8% | +0.6%p |
| 혼합(S미포함, Z1미포함) | 1.2% | 1.2% | 0.0%p |

---

## 지표 5 — 방문 목적별 상세 분석 (Purpose Analysis) ⭐

### 설계 의도

> "이 매장에 오는 사람의 유형이 바뀌었는가? 유형별 만족도는 어떤가?"

`segment` 컬럼(`"유동_생활베이스형_1인"`)에서 4가지 목적 유형 추출:

| 유형 | 설명 | 주요 특성 |
|------|------|----------|
| 생활베이스형 | 혼자 일상적으로 자주 오는 고객 | 재방문율 높음, 혼밥 |
| 사적모임형 | 친구/연인과 오는 고객 | 분위기·맛 중시 |
| 공적모임형 | 업무/미팅 목적 고객 | 서비스·환경 중시 |
| 가족모임형 | 가족 단위 고객 | 메뉴 다양성·가성비 중시 |

**추출 로직:**
```python
def _extract_persona_type(segment: str) -> str:
    # "유동_생활베이스형_1인" → "생활베이스형"
    for kw in ["생활베이스형", "사적모임형", "공적모임형", "가족모임형"]:
        if kw in segment:
            return kw
    return "기타"
```

**5-1 구상: 100% Stacked Bar**
- 비중의 합이 100%가 되도록 쌓음 → 매장 **성격 변화**를 구성 비율로 파악
- 예: 생활베이스형이 60%→35%로 줄고 사적모임형이 15%→40%로 늘면 → 혼밥집에서 모임집으로 성격 전환

**5-2 구상: 유형별 만족도 그룹 바 차트**
- 유형별로 만족도가 어떻게 다른지 교차 분석
- "사적모임형은 많이 오는데 만족도가 낮다" → 분위기/서비스 개선 시그널

### 출력 예시

```
[방문 목적 유형 비중 변화]           [방문 목적 유형별 평균 만족도]

100% ┤가족모임  12%│11%            5.0 ┤
     ├공적모임  10%│14%            4.0 ┤ ─ ─ ─ ─ ─ ─ (만족 기준 4.0)
     ├사적모임  15%│40%            3.0 ┤
 0%  ├생활베이스60%│35%            2.0 ┤
     └──────────────               1.0 ┤
      Sim1  Sim2                       └────────────────────
                                        생활  사적  공적  가족
```

**보고서 테이블:**

| 방문 목적 | 비중(전) | 비중(후) | 비중 변화 | 만족도(전) | 만족도(후) |
|:--------:|:-------:|:-------:|:--------:|:---------:|:---------:|
| 생활베이스형 | 60.2% | 35.1% | -25.1%p | 3.45 | 3.62 |
| 사적모임형 | 15.3% | 40.2% | **+24.9%p** | 3.20 | 3.95 |
| 공적모임형 | 10.1% | 14.3% | +4.2%p | 3.10 | 3.40 |
| 가족모임형 | 14.4% | 10.4% | -4.0%p | 3.55 | 3.70 |

---

## 지표 6 — 재방문율 분석 (Retention)

### 설계 의도

> "새로 왔다가 떠나는 구조인가, 단골이 쌓이는 구조인가?"

`agent_id` 집합 연산으로 계산:

```
retained  = Sim1 방문자 ∩ Sim2 방문자   → 기존 고객 유지
new_users = Sim2 방문자 - Sim1 방문자   → 신규 유입
churned   = Sim1 방문자 - Sim2 방문자   → 이탈
```

- **파이 차트**: Sim2 방문자 중 재방문/신규 구성비 → 성장 방식 파악
- **바 차트**: 이탈/유지/신규 절대 인원 → "신규가 이탈보다 많은가" 직관적 비교

### 출력 예시

```
[Sim2 방문자 구성]            [고객 이탈/유지/신규 현황]

     ╭─────╮                 명수
    ╱ 신규  ╲                30 │  30
   │  42%   │                  │      ■ 25
   │        │                  │           ■ 18
    ╲ 재방문╱                  └──────────────
     ╰─────╯                   이탈  유지  신규
      58%
```

**보고서 테이블:**

| 지표 | 수치 |
|------|:----:|
| Sim 1 방문 에이전트 수 | 43명 |
| Sim 2 방문 에이전트 수 | 43명 |
| 재방문 (기존 고객 유지) | 25명 |
| 신규 유입 | 18명 |
| 이탈 (Churn) | 30명 |
| **기존 고객 유지율** | **45.5%** |
| Sim2 신규 고객 비율 | 41.9% |

---

## 지표 7 — 경쟁 매장 비교 (Radar Chart)

### 설계 의도

> "전략 후 타겟 매장이 경쟁 매장 대비 어떤 포지션인가?"

- Sim2 기준 방문수 **TOP 5 매장** 선정 (타겟 매장은 순위 무관 강제 포함)
- 4개 지표를 **0~100 정규화** 후 레이더 축으로 사용
  - 정규화 이유: 단위가 다른 지표(방문수 수십 ↔ 평점 1~5)를 한 그래프에 표시

**레이더 4개 축:**

| 축 | 계산 방법 | 의미 |
|----|----------|------|
| 방문수 | `len(grp)` | 절대적 인기 |
| 평균평점 | 맛/가성비/분위기 평균 | 고객 만족도 |
| 재방문율 | `동일 agent_id 2회 이상 비율` | 충성도 |
| 리뷰수 | 방문 건수 (review_count) | 구전 효과 가능성 |

- 타겟 매장은 **선 두께 3배 + 채우기 강조** → 경쟁 구도 내 위치 파악

### 출력 예시

```
         방문수
          100
           │
    재방문율──┼──평균평점
           │
         리뷰수

★ 돼지야  ─── 크게 그려짐 (강조)
  경쟁A   --- 얇은 선
  경쟁B   ... 얇은 선
```

**보고서 테이블:**

| 지표 | Sim 1 (타겟) | Sim 2 (타겟) |
|------|:-----------:|:-----------:|
| 방문수 | 142건 | 189건 |
| 평균 평점 | 3.42 | 3.81 |
| 재방문율 | 28.0% | 35.0% |

---

## 지표 9 — 에이전트 유형별 분석 (Agent Type)

### 설계 의도

> "전략이 동네 고객(상주)에게 더 먹혔는가, 외부 유입(유동)에게 더 먹혔는가?"

- `segment.split("_")[0]` → `"유동"` / `"상주"` 자동 파싱
- 두 유형의 비율 변화를 그룹 바 차트로 비교
- 전략 성격에 따라 해석이 달라짐:
  - 유동↑ → 외부 마케팅 효과 (SNS, 광고 유입)
  - 상주↑ → 동네 단골화 성공 (가격·서비스 개선)

**파싱 로직:**
```python
def _extract_agent_type(segment: str) -> str:
    # "유동_사적모임형_2인" → "유동"
    # "상주_생활베이스형_1인" → "상주"
    first = segment.split("_")[0]
    return first if first in ("유동", "상주") else "기타"
```

### 출력 예시

```
[에이전트 유형별 방문 비율 변화]

비율(%)
60 │     +5.3%p
55 │   ■ ■
50 │   ■ ■
   │            -5.3%p
45 │             □ ■
40 │             □ ■
   └─────────────────
      유동         상주
   □ Sim1(전략전)  ■ Sim2(전략후)
```

**보고서 테이블:**

| 유형 | Sim 1 (전략 전) | Sim 2 (전략 후) | 변화 |
|:----:|:--------------:|:--------------:|:----:|
| 유동 | 52.1% | 57.4% | +5.3%p |
| 상주 | 47.9% | 42.6% | -5.3%p |

---

## 지표 10 — 성별 구성 분석 (Gender Composition)

### 설계 의도

> "전략이 특정 성별에 편중되어 있는가? 균형 잡힌 방문이 이루어지고 있는가?"

- `gender_composition` 컬럼 값: `남성만` / `여성만` / `혼성`
- **100% Stacked Bar**: 구성 비중 변화
- **그룹 바 차트**: 변화량(%p) 직접 표기

### 출력 예시

```
[성별 구성 비중]             [성별 구성 비율 변화]

100% ┤혼성   28%│35%         비율(%)
     ├여성만 30%│32%         60 │          +8%p
     ├남성만 42%│33%         55 │   □ ■
 0%  └──────────            50 │           □ ■
      Sim1  Sim2            45 │                  ■ □
                               └─────────────────────
                                남성만   여성만  혼성
```

**보고서 테이블:**

| 성별 구성 | Sim 1 (전략 전) | Sim 2 (전략 후) | 변화 |
|:--------:|:--------------:|:--------------:|:----:|
| 남성만 | 42.0% | 33.0% | -9.0%p |
| 여성만 | 30.0% | 32.0% | +2.0%p |
| 혼성 | 28.0% | 35.0% | **+7.0%p** |

---

## 지표 11 — 세대 × 방문목적 크로스탭 히트맵

### 설계 의도

> "Z세대는 어떤 목적으로 왔고, 그게 전략 후에 어떻게 달라졌는가?"

- 단순 세대별 비율(지표 4)이나 목적별 비율(지표 5)은 **교차 효과**를 놓침
- 크로스탭으로 **세대 × 방문목적** 조합을 동시에 확인
- **행 기준 비율(%)** 정규화: 각 세대 내에서 방문목적 분포를 비교
- Sim1 / Sim2 나란히 표시 → 특정 세대의 목적 전환 파악 가능

**계산 방식:**
```
각 셀 = 해당 세대의 방문 건수 중 해당 방문목적이 차지하는 비율(%)

예: Z1 세대 방문 20건 중 사적모임형 8건 → 셀 값 = 40.0%
```

### 출력 예시

```
[Sim 1 — 전략 전]                            [Sim 2 — 전략 후]
                      생활  사적  공적  가족                        생활  사적  공적  가족
Z1                │ 45%  20%  15%  20% │   Z1                │ 20%  45%  20%  15% │
Z2                │ 50%  25%  15%  10% │   Z2                │ 35%  40%  15%  10% │
Y                 │ 40%  15%  30%  15% │   Y                 │ 40%  20%  25%  15% │
X                 │ 30%  15%  20%  35% │   X                 │ 30%  10%  25%  35% │
S                 │ 55%  10%  10%  25% │   S                 │ 50%  10%  15%  25% │
혼합(S, Z1)        │ 20%  10%  10%  60% │   혼합(S, Z1)        │ 15%  10%  10%  65% │
혼합(S, Z1미포함)   │ 35%  10%  20%  35% │   혼합(S, Z1미포함)   │ 30%  15%  20%  35% │
혼합(S미포함, Z1)   │ 40%  20%  15%  25% │   혼합(S미포함, Z1)   │ 30%  30%  15%  25% │
혼합(S미포함,Z1미포함)│ 45%  25%  20%  10% │   혼합(S미포함,Z1미포함)│ 40%  30%  20%  10% │
```

- 색상이 진할수록 비율 높음 (YlOrRd 컬러맵)
- Z1 세대의 사적모임형 비율 20%→45% 급증 등 복합 변화를 한눈에 확인

---

## 안전성 진단 — `analysis_safety_diagnosis()` + `analysis_tradeoff()`

### 설계 의도

> "전략이 의도치 않은 부작용을 일으키지는 않는가?"

- 1~7, 9~11번 지표를 자동으로 스캔하여 **역효과 자동 탐지**
- 각 항목을 3단계로 분류: `순기능` / `관찰 필요` / `역효과`
- 위험도 공식: `역효과건수 × 15 + 관찰필요건수 × 5` (0~100)
- `analysis_tradeoff()` → 얻은 것(gains) vs 잃은 것(losses) 쌍으로 정리
- 결과는 `metrics_summary["safety"]`에 저장되어 LLM 프롬프트에 자동 포함

**11개 검사 항목:**

| # | 지표 | 역효과 기준 |
|---|------|-----------|
| 1 | 전체 방문 수 | -10% 이상 감소 |
| 2 | 평균 평점 | -0.15점 이상 하락 |
| 3 | 만족도(4점↑) | -5%p 이상 하락 |
| 4 | Y세대 방문 비중 | -3%p 이상 감소 |
| 5 | Z세대(Z1+Z2) 유입 | 감소 시 관찰 필요 |
| 6 | 점심 시간대 트래픽 | -10% 이상 감소 |
| 7 | 생활베이스형 비중 | -5%p 이상 감소 |
| 8 | 사적모임형 비중 | 감소 시 관찰 필요 |
| 9 | 고객 순증감 | 이탈 > 신규 유입 |
| 10 | 가성비 태그 | -2건 이상 감소 |
| 11 | 분위기 태그 | 감소 시 관찰 필요 |

---

## 지표 8 — 종합 평가 (LLM Summary)

### 설계 의도

> "앞 지표들의 수치를 사람이 읽을 수 있는 인사이트 문장으로 변환"

- **LLM 우선순위**: GPT-5.2 (`SUMMARY_OPENAI_API_KEY` + `SUMMARY_OPENAI_MODEL=gpt-5.2` 설정 시) → Gemini fallback → 규칙 기반
- 1~7, 9~11 + 안전성 진단 결과를 `metrics_summary`에서 읽어 구조화 프롬프트로 전달
- **출력 5섹션** (섹션 헤더 고정):
  1. `## 전략의 효과 분석`
  2. `## 바뀐 주 고객층의 특성`
  3. `## 재방문율 및 고객 충성도`
  4. `## 역효과 분석` ← 안전성 진단 기반
  5. `## 향후 권장 사항`
- **규칙 기반 fallback**: API 키 없을 때도 동일 구조 자동 생성

**LLM 입력 프롬프트 구조:**

```
## 핵심 지표 요약

### 방문 지표
- 방문 수: 142건 → 189건 (+33.1%)
- 시장 점유율: 8.2% → 10.5%

### 평점 및 만족도
- 평균 평점: 3.42 → 3.81
- 만족도(4점 이상 비율): 31.0% → 54.5%

### 세대별 방문 비율 변화
- Z1: 12.0% → 20.2% (+8.2%p)
- ...

### 방문 목적 유형별 비중·만족도 변화
- 사적모임형: 비중 15.3%→40.2% (+24.9%p) | 만족도 3.20→3.95
- ...

### 에이전트 유형 (상주 vs 유동) 변화
- 유동: 52.1% → 57.4% (+5.3%p)

### 성별 구성 변화
- 혼성: 28.0% → 35.0% (+7.0%p)

### 재방문율
- 기존 고객 유지율: 45.5%
- 신규 유입: 18명 / 이탈: 30명

### 안전성 진단 결과          ← 신규 추가
- 위험도 점수: 15/100
- 순기능 8건, 관찰 필요 2건, 역효과 1건
- [역효과] 고객 순증감: 이탈(30명) > 신규 유입(18명) — 고객 기반 축소
```

---

## 실행 방법

```bash
# 기본 (경로 자동 추론: data/output/{store}_before, _after)
python sim_to_y.py --target-store 돼지야

# 경로 직접 지정
python sim_to_y.py \
  --target-store 돼지야 \
  --before-dir data/output/돼지야_before \
  --after-dir  data/output/돼지야_after \
  --output-dir reports

# OpenAI API 키 지정 (없으면 규칙 기반 요약)
python sim_to_y.py --target-store 돼지야 --openai-key sk-...
```

## 출력 파일 구조

```
reports/
├── Comparison_Report.md           ← 최종 보고서
└── figures/
    ├── 01_wordcloud.png           ← 지표 1:  워드클라우드 (래스터 → PNG 유지)
    ├── 02_rating_spread.svg       ← 지표 2:  KDE 평점 분포
    ├── 02b_satisfaction_rate.svg  ← 지표 2:  만족도 막대
    ├── 02c_tag_counts.svg         ← 지표 2:  태그별 선택 수
    ├── 03_hourly_traffic.svg      ← 지표 3:  시간대별 트래픽
    ├── 04_generation_impact.svg   ← 지표 4:  세대별 증감 (혼합 포함 6버킷)
    ├── 05_purpose_analysis.svg    ← 지표 5:  방문 목적 분석
    ├── 06_retention.svg           ← 지표 6:  재방문율
    ├── 07_radar_chart.svg         ← 지표 7:  경쟁 레이더 차트
    ├── 09_agent_type.svg          ← 지표 9:  상주 vs 유동
    ├── 10_gender_composition.svg  ← 지표 10: 성별 구성
    └── 11_crosstab_heatmap.svg    ← 지표 11: 세대×방문목적 크로스탭

※ 차트 파일은 벡터(SVG) 형식으로 저장 — 파일 크기 소형, 확대 시 픽셀 깨짐 없음.
   워드클라우드(01)만 래스터 특성상 PNG 유지.
```

---

*`ComparisonReportGenerator` (`sim_to_y.py`) — ABM Simulation Analysis Guide*
